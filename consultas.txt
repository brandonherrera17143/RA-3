-- Active: 1681948395376@@localhost@3307@pos
select * from vendedores;

select * from sucursales;

SELECT * from clientes;

select * from clientes;


select * from clientes where nombre like 'p%' or nombre="brandon";


select * from clientes where Genero="m";

select * from clientes where Genero = "m" AND nombre like 'ad%' or nombre like '%re' or nombre like '%tr%' or nombre="Giles";

select * from productos;

create table factura(
    numero_factura int not null AUTO_INCREMENT PRIMARY KEY,
    fechaEmision DATE,
    id_vendedor int,
    id_cliente int,
    totalFactura DECIMAL(10,2),
    CONSTRAINT fk_vendedor FOREIGN KEY (id_vendedor) REFERENCES vendedores(codigo),
    CONSTRAINT fk_cliente FOREIGN KEY (id_cliente) REFERENCES clientes(codigo) 
);

alter table factura
AUTO_INCREMENT= 1001;

DROP TABLE IF EXISTS factura;
drop table if exists detalle_venta;
create table detalle_venta(
    id_detalle_venta int not null auto_increment PRIMARY KEY,
    id_numeroFactura int,
    id_producto int,
    cantidad int,
    precioUnitario DECIMAL(10,2),
    totalDetalle DECIMAL(10,2),
    CONSTRAINT fk_factura FOREIGN KEY (id_numeroFactura) REFERENCES factura(numero_factura),
    CONSTRAINT fk_producto FOREIGN KEY (id_producto) REFERENCES productos(codigo)


);

DELETE from factura;
INSERT INTO factura(fechaEmision,id_vendedor,id_cliente,totalFactura) VALUES ('2021-10-10',4,2,100.00);

insert into detalle_venta(id_numeroFactura,id_producto,cantidad,precioUnitario,totalDetalle) values(1000,1,2,50.00,100.00);

ALTER TABLE factura MODIFY numero_factura INT AUTO_INCREMENT;
ALTER TABLE factura AUTO_INCREMENT = 1000;





trigguer:   https://www.youtube.com/watch?v=Bhmua17G01Q&t=165s



CREATE DEFINER=`root`@`localhost` TRIGGER `detalle_venta_BEFORE_INSERT` BEFORE INSERT ON `detalle_venta` FOR EACH ROW BEGIN
declare stock_temp int;
set stock_temp=(select cantidad from productos where new.id_producto = productos.codigo)-new.cantidad;
if (stock_temp>=0) then
 update productos set cantidad = stock_temp where codigo=new.id_producto;
 set new.totalDetalle = new.cantidad * (select precio from productos where new.id_producto = codigo);
 update factura set totalFactura= totalFactura+new.totalDetalle where numero_factura=new.id_numeroFactura;
else
SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'No tiene suficiente stock';
END if;
END